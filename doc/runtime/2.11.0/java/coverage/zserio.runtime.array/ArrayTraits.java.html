<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArrayTraits.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Zserio Java Runtime Library</a> &gt; <a href="index.source.html" class="el_package">zserio.runtime.array</a> &gt; <span class="el_source">ArrayTraits.java</span></div><h1>ArrayTraits.java</h1><pre class="source lang-java linenums">package zserio.runtime.array;

import java.io.IOException;
import java.math.BigInteger;

import zserio.runtime.BitSizeOfCalculator;
import zserio.runtime.SizeOf;
import zserio.runtime.array.ArrayElement.IntegralArrayElement;
import zserio.runtime.io.BitBuffer;
import zserio.runtime.io.BitStreamReader;
import zserio.runtime.io.BitStreamWriter;
import zserio.runtime.io.Writer;

/**
 * Interface for array traits.
 *
 * Array traits provides an implementation of zserio functions for one element given by index and raw array.
 */
public interface ArrayTraits
{
    /**
     * Checks if bit size of the array elements is always the same.
     *
     * @return true if bit size of the array elements is constant.
     */
    public boolean isBitSizeOfConstant();

    /**
     * Gets packed array traits.
     *
     * @return Instance of packed array traits or null if the array is not packable.
     */
    public PackedArrayTraits getPackedArrayTraits();

    /**
     * Gets the bit size of the array element if it is stored in the bit stream.
     *
     * @param bitPosition Current bit position in the bit stream.
     * @param element     Array element.
     *
     * @return Bit size of the given array element if it is stored in the bit stream.
     */
    public int bitSizeOf(long bitPosition, ArrayElement element);

    /**
     * Initializes indexed offsets for the array element.
     *
     * @param bitPosition Current bit position in the bit stream.
     * @param element     Array element.
     *
     * @return Updated bit stream position which points to the first bit after the array element.
     */
    public long initializeOffsets(long bitPosition, ArrayElement element);

    /**
     * Reads the array element from the bit stream.
     *
     * @param reader Bit stream reader to read from.
     * @param index  Index of the array element to read.
     *
     * @return Array element filled by read element.
     *
     * @throws IOException Failure during bit stream manipulation.
     */
    public ArrayElement read(BitStreamReader reader, int index) throws IOException;

    /**
     * Writes the array element to the bit stream.
     *
     * @param writer  Bit stream write to write to.
     * @param element Array element.
     *
     * @throws IOException Failure during bit stream manipulation.
     */
    public void write(BitStreamWriter writer, ArrayElement element) throws IOException;

    /**
     * Interface for integral array traits.
     */
    public static interface IntegralArrayTraits extends ArrayTraits
    {
        /**
         * Creates integral array element from given big integer value.
         *
         * @param value Big integer value of the element to create.
         *
         * @return Integral array element.
         */
        public IntegralArrayElement fromBigInteger(BigInteger value);

        /**
         * Gets the bit size of the array element if it is stored in the bit stream.
         *
         * @param element     Array element.
         *
         * @return Bit size of the given array element if it is stored in the bit stream.
         */
        public int bitSizeOf(ArrayElement element);

        /**
         * Reads the array element from the bit stream.
         *
         * @param reader Bit stream reader to read from.
         *
         * @return Array element filled by read element.
         *
         * @throws IOException Failure during bit stream manipulation.
         */
        public IntegralArrayElement read(BitStreamReader reader) throws IOException;
    }

    /**
     * Implementation of common integral array traits functionality.
     */
    public static abstract class IntegralArrayTraitsBase implements IntegralArrayTraits
    {
        /**
         * Constructor.
         */
        public IntegralArrayTraitsBase()
<span class="fc" id="L121">        {</span>
<span class="fc" id="L122">            this.packedArrayTraits = new PackedArrayTraits.IntegralPackedArrayTraits(this);</span>
<span class="fc" id="L123">        }</span>

        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L128">            return packedArrayTraits;</span>
        }

        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L134">            return bitSizeOf(element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L140">            return read(reader);</span>
        }

        private final PackedArrayTraits packedArrayTraits;
    }

    /**
     * Array traits for zserio int8 and int:1...int:8 arrays which are mapped to Java byte[] array.
     */
    public static class SignedBitFieldByteArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public SignedBitFieldByteArrayTraits(int numBits)
<span class="fc" id="L157">        {</span>
<span class="fc" id="L158">            this.numBits = numBits;</span>
<span class="fc" id="L159">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L164">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L170">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L176">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L182">            return new ArrayElement.ByteArrayElement((byte)reader.readSignedBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L188">            writer.writeSignedBits(((ArrayElement.ByteArrayElement)element).get(), numBits);</span>
<span class="fc" id="L189">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L194">            return new ArrayElement.ByteArrayElement(bigInteger.byteValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio int16 and int:9...int:16 arrays which are mapped to Java short[] array.
     */
    public static class SignedBitFieldShortArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public SignedBitFieldShortArrayTraits(int numBits)
<span class="fc" id="L211">        {</span>
<span class="fc" id="L212">            this.numBits = numBits;</span>
<span class="fc" id="L213">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L218">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L224">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L230">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L236">            return new ArrayElement.ShortArrayElement((short)reader.readSignedBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L242">            writer.writeSignedBits(((ArrayElement.ShortArrayElement)element).get(), numBits);</span>
<span class="fc" id="L243">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L248">            return new ArrayElement.ShortArrayElement(bigInteger.shortValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio int32 and int:17...int:32 arrays which are mapped to Java int[] array.
     */
    public static class SignedBitFieldIntArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public SignedBitFieldIntArrayTraits(int numBits)
<span class="fc" id="L265">        {</span>
<span class="fc" id="L266">            this.numBits = numBits;</span>
<span class="fc" id="L267">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L272">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L278">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L284">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L290">            return new ArrayElement.IntArrayElement((int)reader.readSignedBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L296">            writer.writeSignedBits(((ArrayElement.IntArrayElement)element).get(), numBits);</span>
<span class="fc" id="L297">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L302">            return new ArrayElement.IntArrayElement(bigInteger.intValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio int64 and int:33...int:64 arrays which are mapped to Java long[] array.
     */
    public static class SignedBitFieldLongArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public SignedBitFieldLongArrayTraits(int numBits)
<span class="fc" id="L319">        {</span>
<span class="fc" id="L320">            this.numBits = numBits;</span>
<span class="fc" id="L321">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L326">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L332">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L338">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L344">            return new ArrayElement.LongArrayElement(reader.readSignedBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L350">            writer.writeSignedBits(((ArrayElement.LongArrayElement)element).get(), numBits);</span>
<span class="fc" id="L351">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L356">            return new ArrayElement.LongArrayElement(bigInteger.longValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio bit:1...bit:7 arrays which are mapped to Java byte[] array.
     */
    public static class BitFieldByteArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public BitFieldByteArrayTraits(int numBits)
<span class="fc" id="L373">        {</span>
<span class="fc" id="L374">            this.numBits = numBits;</span>
<span class="fc" id="L375">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L380">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L386">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L392">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L398">            return new ArrayElement.ByteArrayElement((byte)reader.readBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L404">            writer.writeBits(((ArrayElement.ByteArrayElement)element).get(), numBits);</span>
<span class="fc" id="L405">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L410">            return new ArrayElement.ByteArrayElement(bigInteger.byteValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio uint8 and bit:8...bit:15 arrays which are mapped to Java short[] array.
     */
    public static class BitFieldShortArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public BitFieldShortArrayTraits(int numBits)
<span class="fc" id="L427">        {</span>
<span class="fc" id="L428">            this.numBits = numBits;</span>
<span class="fc" id="L429">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L434">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L440">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L446">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L452">            return new ArrayElement.ShortArrayElement((short)reader.readBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L458">            writer.writeBits(((ArrayElement.ShortArrayElement)element).get(), numBits);</span>
<span class="fc" id="L459">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L464">            return new ArrayElement.ShortArrayElement(bigInteger.shortValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio uint16 and bit:16...bit:31 arrays which are mapped to Java int[] array.
     */
    public static class BitFieldIntArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public BitFieldIntArrayTraits(int numBits)
<span class="fc" id="L481">        {</span>
<span class="fc" id="L482">            this.numBits = numBits;</span>
<span class="fc" id="L483">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L488">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L494">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L500">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L506">            return new ArrayElement.IntArrayElement((int)reader.readBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L512">            writer.writeBits(((ArrayElement.IntArrayElement)element).get(), numBits);</span>
<span class="fc" id="L513">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L518">            return new ArrayElement.IntArrayElement(bigInteger.intValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio uint32 and bit:32...bit:63 arrays which are mapped to Java long[] array.
     */
    public static class BitFieldLongArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public BitFieldLongArrayTraits(int numBits)
<span class="fc" id="L535">        {</span>
<span class="fc" id="L536">            this.numBits = numBits;</span>
<span class="fc" id="L537">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L542">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L548">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L554">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L560">            return new ArrayElement.LongArrayElement(reader.readBits(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L566">            writer.writeBits(((ArrayElement.LongArrayElement)element).get(), numBits);</span>
<span class="fc" id="L567">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L572">            return new ArrayElement.LongArrayElement(bigInteger.longValue());</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio uint64, bit:64 and dynamic bit field arrays which are mapped to
     * Java BigInteger[] array.
     */
    public static class BitFieldBigIntegerArrayTraits extends IntegralArrayTraitsBase
    {
        /**
         * Constructor from number of bits of zserio type.
         *
         * @param numBits Number of bits of zserio type.
         */
        public BitFieldBigIntegerArrayTraits(int numBits)
<span class="fc" id="L590">        {</span>
<span class="fc" id="L591">            this.numBits = numBits;</span>
<span class="fc" id="L592">        }</span>

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L597">            return true;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L603">            return numBits;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L609">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L615">            return new ArrayElement.BigIntegerArrayElement(reader.readBigInteger(numBits));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L621">            writer.writeBigInteger(((ArrayElement.BigIntegerArrayElement)element).get(), numBits);</span>
<span class="fc" id="L622">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L627">            return new ArrayElement.BigIntegerArrayElement(bigInteger);</span>
        }

        private final int numBits;
    }

    /**
     * Array traits for zserio varint16 arrays which are mapped to Java short[] array.
     */
<span class="fc" id="L636">    public static class VarInt16ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L641">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L647">            return BitSizeOfCalculator.getBitSizeOfVarInt16(((ArrayElement.ShortArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L653">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L659">            return new ArrayElement.ShortArrayElement(reader.readVarInt16());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L665">            writer.writeVarInt16(((ArrayElement.ShortArrayElement)element).get());</span>
<span class="fc" id="L666">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L671">            return new ArrayElement.ShortArrayElement(bigInteger.shortValue());</span>
        }
    }

    /**
     * Array traits for zserio varint32 arrays which are mapped to Java int[] array.
     */
<span class="fc" id="L678">    public static class VarInt32ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L683">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L689">            return BitSizeOfCalculator.getBitSizeOfVarInt32(((ArrayElement.IntArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L695">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L701">            return new ArrayElement.IntArrayElement(reader.readVarInt32());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L707">            writer.writeVarInt32(((ArrayElement.IntArrayElement)element).get());</span>
<span class="fc" id="L708">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L713">            return new ArrayElement.IntArrayElement(bigInteger.intValue());</span>
        }
    }

    /**
     * Array traits for zserio varint64 arrays which are mapped to Java long[] array.
     */
<span class="fc" id="L720">    public static class VarInt64ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L725">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L731">            return BitSizeOfCalculator.getBitSizeOfVarInt64(((ArrayElement.LongArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L737">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L743">            return new ArrayElement.LongArrayElement(reader.readVarInt64());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L749">            writer.writeVarInt64(((ArrayElement.LongArrayElement)element).get());</span>
<span class="fc" id="L750">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="nc" id="L755">            return new ArrayElement.LongArrayElement(bigInteger.longValue());</span>
        }
    }

    /**
     * Array traits for zserio varint arrays which are mapped to Java long[] array.
     */
<span class="fc" id="L762">    public static class VarIntArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L767">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L773">            return BitSizeOfCalculator.getBitSizeOfVarInt(((ArrayElement.LongArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L779">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L785">            return new ArrayElement.LongArrayElement(reader.readVarInt());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L791">            writer.writeVarInt(((ArrayElement.LongArrayElement)element).get());</span>
<span class="fc" id="L792">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="nc" id="L797">            return new ArrayElement.LongArrayElement(bigInteger.longValue());</span>
        }
    }

    /**
     * Array traits for zserio varuint16 arrays which are mapped to Java short[] array.
     */
<span class="fc" id="L804">    public static class VarUInt16ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L809">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L815">            return BitSizeOfCalculator.getBitSizeOfVarUInt16(((ArrayElement.ShortArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L821">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L827">            return new ArrayElement.ShortArrayElement(reader.readVarUInt16());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L833">            writer.writeVarUInt16(((ArrayElement.ShortArrayElement)element).get());</span>
<span class="fc" id="L834">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L839">            return new ArrayElement.ShortArrayElement(bigInteger.shortValue());</span>
        }
    }

    /**
     * Array traits for zserio varuint32 arrays which are mapped to Java int[] array.
     */
<span class="fc" id="L846">    public static class VarUInt32ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L851">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L857">            return BitSizeOfCalculator.getBitSizeOfVarUInt32(((ArrayElement.IntArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L863">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L869">            return new ArrayElement.IntArrayElement(reader.readVarUInt32());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L875">            writer.writeVarUInt32(((ArrayElement.IntArrayElement)element).get());</span>
<span class="fc" id="L876">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L881">            return new ArrayElement.IntArrayElement(bigInteger.intValue());</span>
        }
    }

    /**
     * Array traits for zserio varuint64 arrays which are mapped to Java long[] array.
     */
<span class="fc" id="L888">    public static class VarUInt64ArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L893">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L899">            return BitSizeOfCalculator.getBitSizeOfVarUInt64(((ArrayElement.LongArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L905">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L911">            return new ArrayElement.LongArrayElement(reader.readVarUInt64());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L917">            writer.writeVarUInt64(((ArrayElement.LongArrayElement)element).get());</span>
<span class="fc" id="L918">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L923">            return new ArrayElement.LongArrayElement(bigInteger.longValue());</span>
        }
    }

    /**
     * Array traits for zserio varuint arrays which are mapped to Java BigInteger[] array.
     */
<span class="fc" id="L930">    public static class VarUIntArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L935">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L941">            return BitSizeOfCalculator.getBitSizeOfVarUInt(</span>
<span class="fc" id="L942">                    ((ArrayElement.BigIntegerArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L948">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L954">            return new ArrayElement.BigIntegerArrayElement(reader.readVarUInt());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L960">            writer.writeVarUInt(((ArrayElement.BigIntegerArrayElement)element).get());</span>
<span class="fc" id="L961">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="nc" id="L966">            return new ArrayElement.BigIntegerArrayElement(bigInteger);</span>
        }
    }

    /**
     * Array traits for zserio varsize arrays which are mapped to Java int[] array.
     */
<span class="fc" id="L973">    public static class VarSizeArrayTraits extends IntegralArrayTraitsBase</span>
    {
        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L978">            return false;</span>
        }

        @Override
        public int bitSizeOf(ArrayElement element)
        {
<span class="fc" id="L984">            return BitSizeOfCalculator.getBitSizeOfVarSize(((ArrayElement.IntArrayElement)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L990">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public IntegralArrayElement read(BitStreamReader reader) throws IOException
        {
<span class="fc" id="L996">            return new ArrayElement.IntArrayElement(reader.readVarSize());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1002">            writer.writeVarSize(((ArrayElement.IntArrayElement)element).get());</span>
<span class="fc" id="L1003">        }</span>

        @Override
        public IntegralArrayElement fromBigInteger(BigInteger bigInteger)
        {
<span class="fc" id="L1008">            return new ArrayElement.IntArrayElement(bigInteger.intValue());</span>
        }
    }

    /**
     * Array traits for zserio float16 arrays which are mapped to Java float[] array.
     */
<span class="fc" id="L1015">    public static class Float16ArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1020">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1026">            return true;</span>
        }

        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1032">            return 16;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1038">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1044">            return new ArrayElement.FloatArrayElement(reader.readFloat16());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1050">            writer.writeFloat16(((ArrayElement.FloatArrayElement)element).get());</span>
<span class="fc" id="L1051">        }</span>
    }

    /**
     * Array traits for zserio float32 arrays which are mapped to Java float[] array.
     */
<span class="fc" id="L1057">    public static class Float32ArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1062">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1068">            return true;</span>
        }

        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1074">            return 32;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1080">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1086">            return new ArrayElement.FloatArrayElement(reader.readFloat32());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1092">            writer.writeFloat32(((ArrayElement.FloatArrayElement)element).get());</span>
<span class="fc" id="L1093">        }</span>
    }

    /**
     * Array traits for zserio float64 arrays which are mapped to Java double[] array.
     */
<span class="fc" id="L1099">    public static class Float64ArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1104">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1110">            return true;</span>
        }

        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1116">            return 64;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1122">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1128">            return new ArrayElement.DoubleArrayElement(reader.readFloat64());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1134">            writer.writeFloat64(((ArrayElement.DoubleArrayElement)element).get());</span>
<span class="fc" id="L1135">        }</span>
    }

    /**
     * Array traits for zserio bytes arrays which are mapped to Java byte[][] array.
     */
<span class="fc" id="L1141">    public static class BytesArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1146">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1152">            return false;</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1159">            return BitSizeOfCalculator.getBitSizeOfBytes(</span>
<span class="fc" id="L1160">                    ((ArrayElement.ObjectArrayElement&lt;byte[]&gt;)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1166">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1172">            return new ArrayElement.ObjectArrayElement&lt;&gt;(reader.readBytes());</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1179">            writer.writeBytes(((ArrayElement.ObjectArrayElement&lt;byte[]&gt;)element).get());</span>
<span class="fc" id="L1180">        }</span>
    }

    /**
     * Array traits for zserio string arrays which are mapped to Java String[] array.
     */
<span class="fc" id="L1186">    public static class StringArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1191">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1197">            return false;</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1204">            return BitSizeOfCalculator.getBitSizeOfString(</span>
<span class="fc" id="L1205">                    ((ArrayElement.ObjectArrayElement&lt;String&gt;)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1211">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1217">            return new ArrayElement.ObjectArrayElement&lt;&gt;(reader.readString());</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1224">            writer.writeString(((ArrayElement.ObjectArrayElement&lt;String&gt;)element).get());</span>
<span class="fc" id="L1225">        }</span>
    }

    /**
     * Array traits for zserio bool arrays which are mapped to Java boolean[] array.
     */
<span class="fc" id="L1231">    public static class BoolArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1236">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1242">            return true;</span>
        }

        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1248">            return 1;</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1254">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1260">            return new ArrayElement.BooleanArrayElement(reader.readBool());</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1266">            writer.writeBool(((ArrayElement.BooleanArrayElement)element).get());</span>
<span class="fc" id="L1267">        }</span>
    }

    /**
     * Array traits for zserio extern bit buffer arrays which are mapped to Java BitBuffer[] array.
     */
<span class="fc" id="L1273">    public static class BitBufferArrayTraits implements ArrayTraits</span>
    {
        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1278">            return null;</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1284">            return false;</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1291">            return BitSizeOfCalculator.getBitSizeOfBitBuffer(</span>
<span class="fc" id="L1292">                    ((ArrayElement.ObjectArrayElement&lt;BitBuffer&gt;)element).get());</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1298">            return bitPosition + bitSizeOf(bitPosition, element);</span>
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1304">            return new ArrayElement.ObjectArrayElement&lt;&gt;(reader.readBitBuffer());</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1311">            writer.writeBitBuffer(((ArrayElement.ObjectArrayElement&lt;BitBuffer&gt;)element).get());</span>
<span class="fc" id="L1312">        }</span>
    }

    /**
     * Array traits for zserio object arrays (without writer part) which are mapped to Java zserio object array.
     */
    public static class ObjectArrayTraits&lt;E extends SizeOf&gt; implements ArrayTraits
    {
        /**
         * Constructor from element factory.
         *
         * @param elementFactory Element factory to construct from.
         */
        public ObjectArrayTraits(ElementFactory&lt;E&gt; elementFactory)
<span class="fc" id="L1326">        {</span>
<span class="fc" id="L1327">            this.elementFactory = elementFactory;</span>
<span class="fc" id="L1328">        }</span>

        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="nc" id="L1333">            return new PackedArrayTraits.ObjectPackedArrayTraits&lt;&gt;(elementFactory);</span>
        }

        @Override
        public boolean isBitSizeOfConstant()
        {
<span class="fc" id="L1339">            return false;</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public int bitSizeOf(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1346">            return ((ArrayElement.ObjectArrayElement&lt;E&gt;)element).get().bitSizeOf(bitPosition);</span>
        }

        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="nc" id="L1352">            throw new UnsupportedOperationException(</span>
                    &quot;ArrayTraits: initializeOffsets is not implemented for read only ObjectArrayTraits!&quot;);
        }

        @Override
        public ArrayElement read(BitStreamReader reader, int index) throws IOException
        {
<span class="fc" id="L1359">            return new ArrayElement.ObjectArrayElement&lt;&gt;(elementFactory.create(reader, index));</span>
        }

        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="nc" id="L1365">            throw new UnsupportedOperationException(</span>
                    &quot;ArrayTraits: write is not implemented for read only ObjectArrayTraits!&quot;);
        }

        protected ElementFactory&lt;E&gt; getElementFactory()
        {
<span class="fc" id="L1371">            return elementFactory;</span>
        }

        private final ElementFactory&lt;E&gt; elementFactory;
    }

    /**
     * Array traits for zserio object arrays (with writer part) which are mapped to Java zserio object array.
     */
    public static class WriteObjectArrayTraits&lt;E extends Writer &amp; SizeOf&gt;
            extends ObjectArrayTraits&lt;E&gt;
    {
        /**
         * Constructor from element factory.
         *
         * @param elementFactory Element factory to construct from.
         */
        public WriteObjectArrayTraits(ElementFactory&lt;E&gt; elementFactory)
        {
<span class="fc" id="L1390">            super(elementFactory);</span>
<span class="fc" id="L1391">        }</span>

        @Override
        public PackedArrayTraits getPackedArrayTraits()
        {
<span class="fc" id="L1396">            return new PackedArrayTraits.WriteObjectPackedArrayTraits&lt;&gt;(getElementFactory());</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public long initializeOffsets(long bitPosition, ArrayElement element)
        {
<span class="fc" id="L1403">            return ((ArrayElement.ObjectArrayElement&lt;E&gt;)element).get().initializeOffsets(bitPosition);</span>
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public void write(BitStreamWriter writer, ArrayElement element) throws IOException
        {
<span class="fc" id="L1410">            ((ArrayElement.ObjectArrayElement&lt;E&gt;)element).get().write(writer);</span>
<span class="fc" id="L1411">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>