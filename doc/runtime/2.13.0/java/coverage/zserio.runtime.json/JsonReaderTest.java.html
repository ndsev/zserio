<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonReaderTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Zserio Java Runtime Library</a> &gt; <a href="index.source.html" class="el_package">zserio.runtime.json</a> &gt; <span class="el_source">JsonReaderTest.java</span></div><h1>JsonReaderTest.java</h1><pre class="source lang-java linenums">package zserio.runtime.json;

import static org.junit.Assert.assertTrue;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;

import java.io.IOException;
import java.io.Reader;
import java.io.StringReader;

import org.junit.jupiter.api.Test;

import zserio.runtime.ZserioError;
import zserio.runtime.io.BitBuffer;

import test_object.CreatorBitmask;
import test_object.CreatorEnum;
import test_object.CreatorObject;

<span class="fc" id="L21">public class JsonReaderTest</span>
{
    @Test
    public void readObject() throws IOException
    {
<span class="fc" id="L26">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 13,\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;value\&quot;: 10,\n&quot; +
                &quot;        \&quot;text\&quot;: \&quot;nested\&quot;,\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 203,\n&quot; +
                &quot;                 240\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 12\n&quot; +
                &quot;        },\n&quot; +
                &quot;        \&quot;bytesData\&quot;: {\n&quot; +
                &quot;           \&quot;buffer\&quot;: [\n&quot; +
                &quot;               202,\n&quot; +
                &quot;               254\n&quot; +
                &quot;           ]\n&quot; +
                &quot;        },\n&quot; +
                &quot;        \&quot;creatorEnum\&quot;: 0,\n&quot; +
                &quot;        \&quot;creatorBitmask\&quot;: 1\n&quot; +
                &quot;    },\n&quot; +
                &quot;    \&quot;text\&quot;: \&quot;test\&quot;,\n&quot; +
                &quot;    \&quot;nestedArray\&quot;: [\n&quot; +
                &quot;        {\n&quot; +
                &quot;            \&quot;value\&quot;: 5,\n&quot; +
                &quot;            \&quot;text\&quot;: \&quot;nestedArray\&quot;,\n&quot; +
                &quot;            \&quot;externData\&quot;: {\n&quot; +
                &quot;                 \&quot;buffer\&quot;: [\n&quot; +
                &quot;                     202,\n&quot; +
                &quot;                     254\n&quot; +
                &quot;                 ],&quot; +
                &quot;                 \&quot;bitSize\&quot;: 15\n&quot; +
                &quot;            },\n&quot; +
                &quot;            \&quot;bytesData\&quot;: {\n&quot; +
                &quot;               \&quot;buffer\&quot;: [\n&quot; +
                &quot;                   203,\n&quot; +
                &quot;                   240\n&quot; +
                &quot;               ]\n&quot; +
                &quot;            },\n&quot; +
                &quot;            \&quot;creatorEnum\&quot;: 1,\n&quot; +
                &quot;            \&quot;creatorBitmask\&quot;: 2\n&quot; +
                &quot;        }\n&quot; +
                &quot;    ],\n&quot; +
                &quot;    \&quot;textArray\&quot;: [\n&quot; +
                &quot;        \&quot;this\&quot;,\n&quot; +
                &quot;        \&quot;is\&quot;,\n&quot; +
                &quot;        \&quot;text\&quot;,\n&quot; +
                &quot;        \&quot;array\&quot;\n&quot; +
                &quot;    ],\n&quot; +
                &quot;    \&quot;externArray\&quot;: [\n&quot; +
                &quot;        {\n&quot; +
                &quot;            \&quot;buffer\&quot;: [\n&quot; +
                &quot;                222,\n&quot; +
                &quot;                209\n&quot; +
                &quot;            ],&quot; +
                &quot;            \&quot;bitSize\&quot;: 13\n&quot; +
                &quot;        }\n&quot; +
                &quot;    ],\n&quot; +
                &quot;    \&quot;bytesArray\&quot;: [\n&quot;  +
                &quot;        {\n&quot; +
                &quot;           \&quot;buffer\&quot;: [\n&quot; +
                &quot;               0\n&quot; +
                &quot;           ]\n&quot; +
                &quot;        }\n&quot; +
                &quot;    ],\n&quot; +
                &quot;    \&quot;optionalBool\&quot;: null\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L96">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L97">        final Object zserioObject = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="fc" id="L98">        jsonReader.close();</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">        assertTrue(zserioObject != null);</span>
<span class="fc" id="L100">        final CreatorObject creatorObject = (CreatorObject)zserioObject;</span>

<span class="fc" id="L102">        assertEquals(13, creatorObject.getValue());</span>
<span class="fc" id="L103">        assertEquals(13, creatorObject.getNested().getParam());</span>
<span class="fc" id="L104">        assertEquals(10, creatorObject.getNested().getValue());</span>
<span class="fc" id="L105">        assertEquals(&quot;nested&quot;, creatorObject.getNested().getText());</span>
<span class="fc" id="L106">        assertEquals(new BitBuffer(new byte[] {(byte)0xCB, (byte)0xF0}, 12),</span>
<span class="fc" id="L107">                creatorObject.getNested().getExternData());</span>
<span class="fc" id="L108">        assertArrayEquals(new byte[] {(byte)0xCA, (byte)0xFE}, creatorObject.getNested().getBytesData());</span>
<span class="fc" id="L109">        assertEquals(CreatorEnum.ONE, creatorObject.getNested().getCreatorEnum());</span>
<span class="fc" id="L110">        assertEquals(CreatorBitmask.Values.READ, creatorObject.getNested().getCreatorBitmask());</span>
<span class="fc" id="L111">        assertEquals(&quot;test&quot;, creatorObject.getText());</span>
<span class="fc" id="L112">        assertEquals(1, creatorObject.getNestedArray().length);</span>
<span class="fc" id="L113">        assertEquals(5, creatorObject.getNestedArray()[0].getValue());</span>
<span class="fc" id="L114">        assertEquals(&quot;nestedArray&quot;, creatorObject.getNestedArray()[0].getText());</span>
<span class="fc" id="L115">        assertEquals(new BitBuffer(new byte[] {(byte)0xCA, (byte)0xFE}, 15),</span>
<span class="fc" id="L116">                creatorObject.getNestedArray()[0].getExternData());</span>
<span class="fc" id="L117">        assertArrayEquals(new byte[] {(byte)0xCB, (byte)0xF0}, creatorObject.getNestedArray()[0].getBytesData());</span>
<span class="fc" id="L118">        assertEquals(CreatorEnum.TWO, creatorObject.getNestedArray()[0].getCreatorEnum());</span>
<span class="fc" id="L119">        assertEquals(CreatorBitmask.Values.WRITE, creatorObject.getNestedArray()[0].getCreatorBitmask());</span>
<span class="fc" id="L120">        assertEquals(4, creatorObject.getTextArray().length);</span>
<span class="fc" id="L121">        assertEquals(&quot;this&quot;, creatorObject.getTextArray()[0]);</span>
<span class="fc" id="L122">        assertEquals(&quot;is&quot;, creatorObject.getTextArray()[1]);</span>
<span class="fc" id="L123">        assertEquals(&quot;text&quot;, creatorObject.getTextArray()[2]);</span>
<span class="fc" id="L124">        assertEquals(&quot;array&quot;, creatorObject.getTextArray()[3]);</span>
<span class="fc" id="L125">        assertEquals(1, creatorObject.getExternArray().length);</span>
<span class="fc" id="L126">        assertEquals(new BitBuffer(new byte[] {(byte)0xDE, (byte)0xD1}, 13), creatorObject.getExternArray()[0]);</span>
<span class="fc" id="L127">        assertEquals(1, creatorObject.getBytesArray().length);</span>
<span class="fc" id="L128">        assertArrayEquals(new byte[] {0}, creatorObject.getBytesArray()[0]);</span>
<span class="fc" id="L129">        assertEquals(null, creatorObject.getOptionalBool());</span>
<span class="fc" id="L130">        assertEquals(null, creatorObject.getOptionalNested()); // not present in json</span>
<span class="fc" id="L131">    }</span>

    @Test
    public void readTwoObjects() throws IOException
    {
<span class="fc" id="L136">        final Reader reader = new StringReader(</span>
                &quot;{\&quot;value\&quot;: 13}\n&quot; +
                &quot;{\&quot;value\&quot;: 42, \&quot;text\&quot;: \&quot;test\&quot;}\n&quot;
                );

<span class="fc" id="L141">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L142">        final Object zserioObject1 = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">        assertTrue(zserioObject1 != null);</span>
<span class="fc" id="L144">        final CreatorObject creatorObject1 = (CreatorObject)zserioObject1;</span>

<span class="fc" id="L146">        assertEquals(13, creatorObject1.getValue());</span>
<span class="fc" id="L147">        assertEquals(null, creatorObject1.getText());</span>

<span class="fc" id="L149">        final Object zserioObject2 = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">        assertTrue(zserioObject2 != null);</span>
<span class="fc" id="L151">        final CreatorObject creatorObject2 = (CreatorObject)zserioObject2;</span>

<span class="fc" id="L153">        assertEquals(42, creatorObject2.getValue());</span>
<span class="fc" id="L154">        assertEquals(&quot;test&quot;, creatorObject2.getText());</span>

<span class="fc" id="L156">        jsonReader.close();</span>
<span class="fc" id="L157">    }</span>

    @Test
    public void readUnonrderedBitBuffer() throws IOException
    {
<span class="fc" id="L162">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 13,\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;value\&quot;: 10,\n&quot; +
                &quot;        \&quot;text\&quot;: \&quot;nested\&quot;,\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 12,\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 203,\n&quot; +
                &quot;                 240\n&quot; +
                &quot;             ]\n&quot; +
                &quot;        },\n&quot; +
                &quot;        \&quot;bytesData\&quot;: {\n&quot; +
                &quot;           \&quot;buffer\&quot;: [\n&quot; +
                &quot;               202,\n&quot; +
                &quot;               254\n&quot; +
                &quot;           ]\n&quot; +
                &quot;        },\n&quot; +
                &quot;        \&quot;creatorEnum\&quot;: -1,\n&quot; +
                &quot;        \&quot;creatorBitmask\&quot;: 1\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L187">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L188">        final Object zserioObject = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        assertTrue(zserioObject != null);</span>
<span class="fc" id="L190">        final CreatorObject creatorObject = (CreatorObject)zserioObject;</span>

<span class="fc" id="L192">        assertEquals(13, creatorObject.getValue());</span>
<span class="fc" id="L193">        assertEquals(13, creatorObject.getNested().getParam());</span>
<span class="fc" id="L194">        assertEquals(10, creatorObject.getNested().getValue());</span>
<span class="fc" id="L195">        assertEquals(&quot;nested&quot;, creatorObject.getNested().getText());</span>
<span class="fc" id="L196">        assertEquals(new BitBuffer(new byte[] {(byte)0xCB, (byte)0xF0}, 12),</span>
<span class="fc" id="L197">                creatorObject.getNested().getExternData());</span>
<span class="fc" id="L198">        assertArrayEquals(new byte[] {(byte)0xCA, (byte)0xFE}, creatorObject.getNested().getBytesData());</span>
<span class="fc" id="L199">        assertEquals(CreatorEnum.MinusOne, creatorObject.getNested().getCreatorEnum());</span>
<span class="fc" id="L200">        assertEquals(CreatorBitmask.Values.READ, creatorObject.getNested().getCreatorBitmask());</span>

<span class="fc" id="L202">        jsonReader.close();</span>
<span class="fc" id="L203">    }</span>

    @Test
    public void readStringifiedEnum() throws IOException
    {
<span class="fc" id="L208">        checkReadStringifiedEnum(&quot;ONE&quot;, CreatorEnum.ONE);</span>
<span class="fc" id="L209">        checkReadStringifiedEnum(&quot;MinusOne&quot;, CreatorEnum.MinusOne);</span>
<span class="fc" id="L210">        checkReadStringifiedEnumThrows(&quot;NONEXISTING&quot;,</span>
                &quot;JsonReader: Cannot create enum 'test_object.CreatorEnum' &quot; +
                &quot;from string value 'NONEXISTING'! (JsonParser:3:24)&quot;);
<span class="fc" id="L213">        checkReadStringifiedEnumThrows(&quot;***&quot;,</span>
                &quot;JsonReader: Cannot create enum 'test_object.CreatorEnum' &quot; +
                &quot;from string value '***'! (JsonParser:3:24)&quot;);
<span class="fc" id="L216">        checkReadStringifiedEnumThrows(&quot;10 /* no match */&quot;,</span>
                &quot;JsonReader: Cannot create enum 'test_object.CreatorEnum' &quot; +
                &quot;from string value '10 /* no match */'! (JsonParser:3:24)&quot;);
<span class="fc" id="L219">        checkReadStringifiedEnumThrows(&quot;-10 /* no match */&quot;,</span>
                &quot;JsonReader: Cannot create enum 'test_object.CreatorEnum' &quot; +
                &quot;from string value '-10 /* no match */'! (JsonParser:3:24)&quot;);
<span class="fc" id="L222">        checkReadStringifiedEnumThrows(&quot;&quot;,</span>
                &quot;JsonReader: Cannot create enum 'test_object.CreatorEnum' &quot; +
                &quot;from string value ''! (JsonParser:3:24)&quot;);
<span class="fc" id="L225">    }</span>

    @Test
    public void readStringifiedBitmask() throws IOException
    {
<span class="fc" id="L230">        checkReadStringifiedBitmask(&quot;READ&quot;, CreatorBitmask.Values.READ);</span>
<span class="fc" id="L231">        checkReadStringifiedBitmask(&quot;READ | WRITE&quot;, CreatorBitmask.Values.READ.or(CreatorBitmask.Values.WRITE));</span>
<span class="fc" id="L232">        checkReadStringifiedBitmaskThrows(&quot;NONEXISTING&quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value 'NONEXISTING'! (JsonParser:3:27)&quot;);
<span class="fc" id="L235">        checkReadStringifiedBitmaskThrows(&quot;READ | NONEXISTING&quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value 'READ | NONEXISTING'! (JsonParser:3:27)&quot;);
<span class="fc" id="L238">        checkReadStringifiedBitmaskThrows(&quot;READ * NONEXISTING&quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value 'READ * NONEXISTING'! (JsonParser:3:27)&quot;);
<span class="fc" id="L241">        checkReadStringifiedBitmask(&quot;7 /* READ | WRITE */&quot;, new CreatorBitmask((short)7));</span>
<span class="fc" id="L242">        checkReadStringifiedBitmask(&quot;15 /* READ | WRITE */&quot;, new CreatorBitmask((short)15));</span>
<span class="fc" id="L243">        checkReadStringifiedBitmask(&quot;4 /* no match */&quot;, new CreatorBitmask((short)4));</span>
<span class="fc" id="L244">        checkReadStringifiedBitmaskThrows(&quot;&quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value ''! (JsonParser:3:27)&quot;);
<span class="fc" id="L247">        checkReadStringifiedBitmaskThrows(&quot; &quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value ' '! (JsonParser:3:27)&quot;);
<span class="fc" id="L250">        checkReadStringifiedBitmaskThrows(&quot; | &quot;,</span>
                &quot;JsonReader: Cannot create bitmask 'test_object.CreatorBitmask' &quot; +
                &quot;from string value ' | '! (JsonParser:3:27)&quot;);
<span class="fc" id="L253">    }</span>

    @Test
    public void jsonParserException() throws IOException
    {
<span class="fc" id="L258">        final Reader reader = new StringReader(</span>
                &quot;{\&quot;value\&quot;\n\&quot;value\&quot;&quot;
                );

<span class="fc" id="L262">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L263">        final JsonParserError exception = assertThrows(JsonParserError.class,</span>
<span class="nc" id="L264">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L265">        assertEquals(&quot;JsonParser:2:1: Unexpected token: VALUE ('value'), expecting KEY_SEPARATOR!&quot;,</span>
<span class="fc" id="L266">                exception.getMessage());</span>
<span class="fc" id="L267">        jsonReader.close();</span>
<span class="fc" id="L268">    }</span>

    @Test
    public void wrongKeyException() throws IOException
    {
<span class="fc" id="L273">        final Reader reader = new StringReader(</span>
                &quot;{\&quot;value\&quot;: 13,\n\&quot;nonexisting\&quot;: 10}&quot;
                );

<span class="fc" id="L277">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L278">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L279">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L280">        assertEquals(&quot;ZserioTreeCreator: Field 'nonexisting' not found in &quot; +</span>
<span class="fc" id="L281">                &quot;'test_object.CreatorObject'! (JsonParser:2:16)&quot;, exception.getMessage());</span>
<span class="fc" id="L282">        jsonReader.close();</span>
<span class="fc" id="L283">    }</span>

    @Test
    public void wrongValueTypeException() throws IOException
    {
<span class="fc" id="L288">        final Reader reader = new StringReader(</span>
                &quot;{\n  \&quot;value\&quot;: \&quot;13\&quot;\n}&quot;
                );

<span class="fc" id="L292">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L293">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L294">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L295">        assertEquals(&quot;ZserioTreeCreator: Unexpected value type 'class java.lang.String', expecting 'long'! &quot; +</span>
<span class="fc" id="L296">                &quot;(JsonParser:2:12)&quot;, exception.getMessage());</span>
<span class="fc" id="L297">        jsonReader.close();</span>
<span class="fc" id="L298">    }</span>

    @Test
    public void wrongBitBufferException() throws IOException
    {
<span class="fc" id="L303">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 13,\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;value\&quot;: 10,\n&quot; +
                &quot;        \&quot;text\&quot;: \&quot;nested\&quot;,\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 203,\n&quot; +
                &quot;                 240\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: {\n&quot; +
                &quot;             }\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L321">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L322">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L323">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L324">        assertEquals(&quot;JsonReader: Unexpected begin object in Bit Buffer! (JsonParser:11:25)&quot;,</span>
<span class="fc" id="L325">                exception.getMessage());</span>
<span class="fc" id="L326">        jsonReader.close();</span>
<span class="fc" id="L327">    }</span>

    @Test
    public void partialBitBufferException() throws IOException
    {
<span class="fc" id="L332">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 13,\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;value\&quot;: 10,\n&quot; +
                &quot;        \&quot;text\&quot;: \&quot;nested\&quot;,\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 203,\n&quot; +
                &quot;                 240\n&quot; +
                &quot;             ]\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L348">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L349">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L350">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L351">        assertEquals(&quot;JsonReader: Unexpected end in Bit Buffer! (JsonParser:12:5)&quot;, exception.getMessage());</span>
<span class="fc" id="L352">        jsonReader.close();</span>
<span class="fc" id="L353">    }</span>

    @Test
    public void wrongBytesException() throws IOException
    {
<span class="fc" id="L358">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 13,\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;value\&quot;: 10,\n&quot; +
                &quot;        \&quot;text\&quot;: \&quot;nested\&quot;,\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 203,\n&quot; +
                &quot;                 240\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 12\n&quot; +
                &quot;        },\n&quot; +
                &quot;        \&quot;bytesData\&quot;: {\n&quot; +
                &quot;            \&quot;buffer\&quot;: {}\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L378">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L379">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L380">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L381">        assertEquals(&quot;JsonReader: Unexpected begin object in bytes! (JsonParser:14:23)&quot;,</span>
<span class="fc" id="L382">                exception.getMessage());</span>
<span class="fc" id="L383">        jsonReader.close();</span>
<span class="fc" id="L384">    }</span>

    @Test
    public void jsonArrayException() throws IOException
    {
<span class="fc" id="L389">        final Reader reader = new StringReader(</span>
                &quot;[1, 2]&quot;
                );

<span class="fc" id="L393">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L394">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L395">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L396">        assertEquals(&quot;JsonReader: ZserioTreeCreator expects json object! (JsonParser:1:1)&quot;,</span>
<span class="fc" id="L397">                exception.getMessage());</span>
<span class="fc" id="L398">        jsonReader.close();</span>
<span class="fc" id="L399">    }</span>

    @Test
    public void jsonValueException() throws IOException
    {
<span class="fc" id="L404">        final Reader reader = new StringReader(</span>
                &quot;\&quot;text\&quot;&quot;
                );

<span class="fc" id="L408">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L409">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L410">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L411">        assertEquals(&quot;JsonReader: ZserioTreeCreator expects json object! (JsonParser:1:1)&quot;,</span>
<span class="fc" id="L412">                exception.getMessage());</span>
<span class="fc" id="L413">        jsonReader.close();</span>
<span class="fc" id="L414">    }</span>

    @Test
    public void bigLongValueException() throws IOException
    {
<span class="fc" id="L419">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 9223372036854775808\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L425">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L426">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L427">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L428">        assertEquals(&quot;JsonReader: Cannot create long 'uint32' from value '9223372036854775808'! &quot; +</span>
<span class="fc" id="L429">                &quot;(JsonParser:2:14)&quot;, exception.getMessage());</span>
<span class="fc" id="L430">        jsonReader.close();</span>
<span class="fc" id="L431">    }</span>

    @Test
    public void floatLongValueException() throws IOException
    {
<span class="fc" id="L436">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;value\&quot;: 1.234\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L442">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L443">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L444">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L445">        assertEquals(&quot;ZserioTreeCreator: Unexpected value type 'class java.lang.Double', expecting 'long'! &quot; +</span>
<span class="fc" id="L446">                &quot;(JsonParser:2:14)&quot;, exception.getMessage());</span>
<span class="fc" id="L447">        jsonReader.close();</span>
<span class="fc" id="L448">    }</span>

    @Test
    public void bigBitBufferByteValueException() throws IOException
    {
<span class="fc" id="L453">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 256\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 7\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L466">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L467">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L468">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L469">        assertEquals(&quot;JsonReader: Cannot create byte for Bit Buffer from value '256'! (JsonParser:5:18)&quot;,</span>
<span class="fc" id="L470">                exception.getMessage());</span>
<span class="fc" id="L471">        jsonReader.close();</span>
<span class="fc" id="L472">    }</span>

    @Test
    public void negativeBitBufferByteValueException() throws IOException
    {
<span class="fc" id="L477">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 -1\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 7\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L490">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L491">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L492">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L493">        assertEquals(&quot;JsonReader: Cannot create byte for Bit Buffer from value '-1'! (JsonParser:5:18)&quot;,</span>
<span class="fc" id="L494">                exception.getMessage());</span>
<span class="fc" id="L495">        jsonReader.close();</span>
<span class="fc" id="L496">    }</span>

    @Test
    public void wrongBitBufferSizeValueException() throws IOException
    {
<span class="fc" id="L501">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;externData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 255\n&quot; +
                &quot;             ],\n&quot; +
                &quot;             \&quot;bitSize\&quot;: 9223372036854775808\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L514">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L515">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L516">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L517">        assertEquals(&quot;JsonReader: Cannot create long for Bit Buffer size from value '9223372036854775808'! &quot; +</span>
<span class="fc" id="L518">                &quot;(JsonParser:7:25)&quot;, exception.getMessage());</span>
<span class="fc" id="L519">        jsonReader.close();</span>
<span class="fc" id="L520">    }</span>

    @Test
    public void bigBytesByteValueException() throws IOException
    {
<span class="fc" id="L525">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;bytesData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 256\n&quot; +
                &quot;             ]\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L537">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L538">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L539">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L540">        assertEquals(&quot;JsonReader: Cannot create byte for bytes from value '256'! (JsonParser:5:18)&quot;,</span>
<span class="fc" id="L541">                exception.getMessage());</span>
<span class="fc" id="L542">        jsonReader.close();</span>
<span class="fc" id="L543">    }</span>

    @Test
    public void negativeBytesByteValueException() throws IOException
    {
<span class="fc" id="L548">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;bytesData\&quot;: {\n&quot; +
                &quot;             \&quot;buffer\&quot;: [\n&quot; +
                &quot;                 -1\n&quot; +
                &quot;             ]\n&quot; +
                &quot;        }\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L560">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L561">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L562">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L563">        assertEquals(&quot;JsonReader: Cannot create byte for bytes from value '-1'! (JsonParser:5:18)&quot;,</span>
<span class="fc" id="L564">                exception.getMessage());</span>
<span class="fc" id="L565">        jsonReader.close();</span>
<span class="fc" id="L566">    }</span>

    private void checkReadStringifiedEnum(String stringValue, CreatorEnum expectedValue) throws IOException
    {
<span class="fc" id="L570">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;creatorEnum\&quot;: \&quot;&quot; + stringValue + &quot;\&quot;\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L578">        try (final JsonReader jsonReader = new JsonReader(reader))</span>
        {
<span class="fc" id="L580">            final Object zserioObject = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="pc bpc" id="L581" title="1 of 2 branches missed.">            assertTrue(zserioObject != null);</span>
<span class="fc" id="L582">            final CreatorObject creatorObject = (CreatorObject)zserioObject;</span>

<span class="fc" id="L584">            assertEquals(expectedValue, creatorObject.getNested().getCreatorEnum());</span>
        }
<span class="fc" id="L586">    }</span>

    private void checkReadStringifiedEnumThrows(String stringValue, String expectedMessage) throws IOException
    {
<span class="fc" id="L590">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;creatorEnum\&quot;: \&quot;&quot; + stringValue + &quot;\&quot;\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L598">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L599">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L600">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L601">        assertEquals(expectedMessage, exception.getMessage());</span>
<span class="fc" id="L602">        jsonReader.close();</span>
<span class="fc" id="L603">    }</span>

    private void checkReadStringifiedBitmask(String stringValue, CreatorBitmask expectedValue) throws IOException
    {
<span class="fc" id="L607">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;creatorBitmask\&quot;: \&quot;&quot; + stringValue + &quot;\&quot;\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L615">        try (final JsonReader jsonReader = new JsonReader(reader))</span>
        {
<span class="fc" id="L617">            final Object zserioObject = jsonReader.read(CreatorObject.typeInfo());</span>
<span class="pc bpc" id="L618" title="1 of 2 branches missed.">            assertTrue(zserioObject != null);</span>
<span class="fc" id="L619">            final CreatorObject creatorObject = (CreatorObject)zserioObject;</span>

<span class="fc" id="L621">            assertEquals(expectedValue, creatorObject.getNested().getCreatorBitmask());</span>
        }
<span class="fc" id="L623">    }</span>

    private void checkReadStringifiedBitmaskThrows(String stringValue, String expectedMessage)
            throws IOException
    {
<span class="fc" id="L628">        final Reader reader = new StringReader(</span>
                &quot;{\n&quot; +
                &quot;    \&quot;nested\&quot;: {\n&quot; +
                &quot;        \&quot;creatorBitmask\&quot;: \&quot;&quot; + stringValue + &quot;\&quot;\n&quot; +
                &quot;    }\n&quot; +
                &quot;}&quot;
                );

<span class="fc" id="L636">        final JsonReader jsonReader = new JsonReader(reader);</span>
<span class="fc" id="L637">        final ZserioError exception = assertThrows(ZserioError.class,</span>
<span class="nc" id="L638">                () -&gt; jsonReader.read(CreatorObject.typeInfo()));</span>
<span class="fc" id="L639">        assertEquals(expectedMessage, exception.getMessage());</span>
<span class="fc" id="L640">        jsonReader.close();</span>
<span class="fc" id="L641">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>