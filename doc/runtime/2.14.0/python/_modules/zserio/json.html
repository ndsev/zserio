<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zserio.json &#8212; Zserio 2.14.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=4a6762d5" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=5a74bcf3"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for zserio.json</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The module implements WalkObserver for writing of zserio objects to JSON format.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">from</span> <span class="nn">zserio.bitbuffer</span> <span class="kn">import</span> <span class="n">BitBuffer</span>
<span class="kn">from</span> <span class="nn">zserio.creator</span> <span class="kn">import</span> <span class="n">ZserioTreeCreator</span>
<span class="kn">from</span> <span class="nn">zserio.exception</span> <span class="kn">import</span> <span class="n">PythonRuntimeException</span>
<span class="kn">from</span> <span class="nn">zserio.typeinfo</span> <span class="kn">import</span> <span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">,</span> <span class="n">TypeAttribute</span><span class="p">,</span> <span class="n">MemberInfo</span>
<span class="kn">from</span> <span class="nn">zserio.walker</span> <span class="kn">import</span> <span class="n">WalkObserver</span>


<div class="viewcode-block" id="JsonEnumerableFormat"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonEnumerableFormat">[docs]</a><span class="k">class</span> <span class="nc">JsonEnumerableFormat</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration for writing of enumerable types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Print as JSON integral value.</span>
    <span class="n">NUMBER</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="c1">#: Print as JSON string according to the following rules:</span>
    <span class="c1">#:</span>
    <span class="c1">#: #. Enums</span>
    <span class="c1">#:</span>
    <span class="c1">#:    * when an exact match with an enumerable item is found, the item name is used - e.g. &quot;FIRST&quot;,</span>
    <span class="c1">#:    * when no exact match is found, it&#39;s an invalid value, the integral value is converted to string</span>
    <span class="c1">#:      and an appropriate comment is included - e.g. &quot;10 /\* no match \*/&quot;.</span>
    <span class="c1">#:</span>
    <span class="c1">#: #. Bitmasks</span>
    <span class="c1">#:</span>
    <span class="c1">#:    * when an exact mach with or-ed bitmask values is found, it&#39;s used - e.g. &quot;READ | WRITE&quot;,</span>
    <span class="c1">#:    * when no exact match is found, but some or-ed values match, the integral value is converted</span>
    <span class="c1">#:      to string and the or-ed values are included in a comment - e.g. &quot;127 /\* READ | CREATE \*/&quot;,</span>
    <span class="c1">#:    * when no match is found at all, the integral value is converted to string and an appropriate</span>
    <span class="c1">#:      comment is included - e.g. &quot;13 /\* no match \*/&quot;.</span>
    <span class="n">STRING</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="JsonWriter"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter">[docs]</a><span class="k">class</span> <span class="nc">JsonWriter</span><span class="p">(</span><span class="n">WalkObserver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Walker observer which dumps zserio objects to JSON format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">text_io</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enumerable_format</span><span class="p">:</span> <span class="n">JsonEnumerableFormat</span> <span class="o">=</span> <span class="n">JsonEnumerableFormat</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
        <span class="n">item_separator</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">key_separator</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param text_io: Optional text stream for JSON output, io.StringIO is used by default.</span>
<span class="sd">        :param item_separator: Optional item separator, default is &#39;, &#39; if indent is None, &#39;,&#39; otherwise.</span>
<span class="sd">        :param key_separator: Optional key separator, default is &#39;: &#39;.</span>
<span class="sd">        :param enumerable_format: Optional enumerable format to use, default is JsonEnumerableFormat.STRING.</span>
<span class="sd">        :param indent: String or (non-negative) integer defining the indent. If not None, newlines are inserted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span> <span class="o">=</span> <span class="n">text_io</span> <span class="k">if</span> <span class="n">text_io</span> <span class="k">else</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_item_separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">item_separator</span> <span class="k">if</span> <span class="n">item_separator</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="k">if</span> <span class="n">indent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;, &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key_separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">key_separator</span> <span class="k">if</span> <span class="n">key_separator</span> <span class="k">else</span> <span class="s2">&quot;: &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enumerable_format</span> <span class="o">=</span> <span class="n">enumerable_format</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">indent</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">)</span> <span class="k">if</span> <span class="n">indent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span> <span class="o">=</span> <span class="n">JsonEncoder</span><span class="p">()</span>

<div class="viewcode-block" id="JsonWriter.get_io"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.get_io">[docs]</a>    <span class="k">def</span> <span class="nf">get_io</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the underlying text stream.</span>

<span class="sd">        :returns: Underlying text steam.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_io</span></div>

<div class="viewcode-block" id="JsonWriter.begin_root"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.begin_root">[docs]</a>    <span class="k">def</span> <span class="nf">begin_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_compound</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_object</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.end_root"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.end_root">[docs]</a>    <span class="k">def</span> <span class="nf">end_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_compound</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_object</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.begin_array"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.begin_array">[docs]</a>    <span class="k">def</span> <span class="nf">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="n">member_info</span><span class="o">.</span><span class="n">schema_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_array</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.end_array"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.end_array">[docs]</a>    <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_array</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.begin_compound"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.begin_compound">[docs]</a>    <span class="k">def</span> <span class="nf">begin_compound</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">compound</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">,</span>
        <span class="n">element_index</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">element_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="n">member_info</span><span class="o">.</span><span class="n">schema_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_object</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.end_compound"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.end_compound">[docs]</a>    <span class="k">def</span> <span class="nf">end_compound</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">compound</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">,</span>
        <span class="n">_element_index</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_object</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonWriter.visit_value"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonWriter.visit_value">[docs]</a>    <span class="k">def</span> <span class="nf">visit_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">,</span>
        <span class="n">element_index</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">element_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="n">member_info</span><span class="o">.</span><span class="n">schema_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">member_info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_begin_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_first</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_item_separator</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_end_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_first</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_begin_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_end_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_first</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indent</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_separator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">member_info</span><span class="p">:</span> <span class="n">MemberInfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">type_info</span> <span class="o">=</span> <span class="n">member_info</span><span class="o">.</span><span class="n">type_info</span>
        <span class="k">if</span> <span class="n">type_info</span><span class="o">.</span><span class="n">schema_name</span> <span class="o">==</span> <span class="s2">&quot;extern&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_bitbuffer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_info</span><span class="o">.</span><span class="n">schema_name</span> <span class="o">==</span> <span class="s2">&quot;bytes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">TypeAttribute</span><span class="o">.</span><span class="n">ENUM_ITEMS</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enumerable_format</span> <span class="o">==</span> <span class="n">JsonEnumerableFormat</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_write_stringified_enum</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">TypeAttribute</span><span class="o">.</span><span class="n">BITMASK_VALUES</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enumerable_format</span> <span class="o">==</span> <span class="n">JsonEnumerableFormat</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_write_stringified_bitmask</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_bitbuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">BitBuffer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="s2">&quot;buffer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_array</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">byte</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="s2">&quot;bitSize&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">bitsize</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_object</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_key</span><span class="p">(</span><span class="s2">&quot;buffer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_begin_array</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_begin_item</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">byte</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_object</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_write_stringified_enum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">TypeAttribute</span><span class="o">.</span><span class="n">ENUM_ITEMS</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">py_item</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="c1"># exact match</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">schema_name</span><span class="p">))</span>
                <span class="k">return</span>

        <span class="c1"># no match</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; /* no match */&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_stringified_bitmask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="n">string_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">bitmask_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="n">value_check</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">item_info</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">TypeAttribute</span><span class="o">.</span><span class="n">BITMASK_VALUES</span><span class="p">]:</span>
            <span class="n">is_zero</span> <span class="o">=</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_zero</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bitmask_value</span> <span class="o">&amp;</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span><span class="o">.</span><span class="n">value</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">is_zero</span> <span class="ow">and</span> <span class="n">bitmask_value</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">value_check</span> <span class="o">|=</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">string_value</span><span class="p">:</span>
                    <span class="n">string_value</span> <span class="o">+=</span> <span class="s2">&quot; | &quot;</span>
                <span class="n">string_value</span> <span class="o">+=</span> <span class="n">item_info</span><span class="o">.</span><span class="n">schema_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">string_value</span><span class="p">:</span>
            <span class="c1"># no match</span>
            <span class="n">string_value</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bitmask_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; /* no match */&quot;</span>
        <span class="k">elif</span> <span class="n">bitmask_value</span> <span class="o">!=</span> <span class="n">value_check</span><span class="p">:</span>
            <span class="c1"># partial match</span>
            <span class="n">string_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bitmask_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; /* partial match: &quot;</span> <span class="o">+</span> <span class="n">string_value</span> <span class="o">+</span> <span class="s2">&quot; */&quot;</span>
        <span class="c1"># else exact match</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_json_encoder</span><span class="o">.</span><span class="n">encode_value</span><span class="p">(</span><span class="n">string_value</span><span class="p">))</span></div>


<div class="viewcode-block" id="JsonEncoder"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonEncoder">[docs]</a><span class="k">class</span> <span class="nc">JsonEncoder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts zserio values to Json string representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_encoder</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">(</span><span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="JsonEncoder.encode_value"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonEncoder.encode_value">[docs]</a>    <span class="k">def</span> <span class="nf">encode_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encodes value to JSON string representation.</span>

<span class="sd">        :param value: Value to encode.</span>

<span class="sd">        :returns: Value encoded to string as a valid JSON value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="JsonToken"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonToken">[docs]</a><span class="k">class</span> <span class="nc">JsonToken</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tokens used by Json Tokenizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">BEGIN_OF_FILE</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">END_OF_FILE</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">BEGIN_OBJECT</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">END_OBJECT</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">BEGIN_ARRAY</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">END_ARRAY</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">KEY_SEPARATOR</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">ITEM_SEPARATOR</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
    <span class="n">VALUE</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="JsonParserException"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParserException">[docs]</a><span class="k">class</span> <span class="nc">JsonParserException</span><span class="p">(</span><span class="n">PythonRuntimeException</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception used to distinguish exceptions from the JsonParser.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="JsonParser"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser">[docs]</a><span class="k">class</span> <span class="nc">JsonParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Json Parser.</span>

<span class="sd">    Parses the JSON on the fly and calls an observer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JsonParser.Observer"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer">[docs]</a>    <span class="k">class</span> <span class="nc">Observer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Json parser observer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JsonParser.Observer.begin_object"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.begin_object">[docs]</a>        <span class="k">def</span> <span class="nf">begin_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called when a JSON object begins - i.e. on &#39;{&#39;.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.Observer.end_object"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.end_object">[docs]</a>        <span class="k">def</span> <span class="nf">end_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called when a JSON object ends - i.e. on &#39;}&#39;.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.Observer.begin_array"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.begin_array">[docs]</a>        <span class="k">def</span> <span class="nf">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called when a JSON array begins - i.e. on &#39;[&#39;.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.Observer.end_array"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.end_array">[docs]</a>        <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called when a JSON array ends - i.e. on &#39;]&#39;.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.Observer.visit_key"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.visit_key">[docs]</a>        <span class="k">def</span> <span class="nf">visit_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called on a JSON key.</span>

<span class="sd">            :param key: Key value.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.Observer.visit_value"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.Observer.visit_value">[docs]</a>        <span class="k">def</span> <span class="nf">visit_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Called on a JSON value.</span>

<span class="sd">            :param value: JSON value.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_io</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">,</span> <span class="n">observer</span><span class="p">:</span> <span class="n">Observer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param text_io: Text stream to parse.</span>
<span class="sd">        :param observer: Observer to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span> <span class="o">=</span> <span class="n">JsonTokenizer</span><span class="p">(</span><span class="n">text_io</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span> <span class="o">=</span> <span class="n">observer</span>

<div class="viewcode-block" id="JsonParser.parse"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses single JSON element from the text stream.</span>

<span class="sd">        :returns: True when end-of-file is reached, False otherwise (i.e. another JSON element is present).</span>
<span class="sd">        :raises JsonParserException: When parsing fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_OF_FILE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_element</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span></div>

<div class="viewcode-block" id="JsonParser.get_line"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.get_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current line number.</span>

<span class="sd">        :returns: Line number.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_line</span><span class="p">()</span></div>

<div class="viewcode-block" id="JsonParser.get_column"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonParser.get_column">[docs]</a>    <span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current column number.</span>

<span class="sd">        :returns: Column number.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_column</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_parse_element</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_ARRAY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_array</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">token</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_OBJECT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_object</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">token</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_value</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_unexpected_token</span><span class="p">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="n">ELEMENT_TOKENS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">begin_array</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">JsonParser</span><span class="o">.</span><span class="n">ELEMENT_TOKENS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_elements</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_consume_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_ARRAY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">end_array</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_element</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">ITEM_SEPARATOR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_element</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">begin_object</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_members</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_consume_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OBJECT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">end_object</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_members</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_member</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">ITEM_SEPARATOR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_member</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_member</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">VALUE</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">JsonParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JsonParser:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_line</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">()</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="sa">f</span><span class="s2">&quot;Key must be a string value!&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">visit_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_consume_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">KEY_SEPARATOR</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_element</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observer</span><span class="o">.</span><span class="n">visit_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_consume_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">JsonToken</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">JsonToken</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span> <span class="o">!=</span> <span class="n">token</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_unexpected_token</span><span class="p">([</span><span class="n">token</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_raise_unexpected_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expecting</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">JsonToken</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;JsonParser:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_line</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_column</span><span class="p">()</span><span class="si">}</span><span class="s2">: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected token: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expecting</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, expecting </span><span class="si">{</span><span class="n">expecting</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">!&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;, expecting one of [&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">expecting</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;]!&quot;</span>

        <span class="k">raise</span> <span class="n">JsonParserException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">ELEMENT_TOKENS</span> <span class="o">=</span> <span class="p">[</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_OBJECT</span><span class="p">,</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_ARRAY</span><span class="p">,</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">VALUE</span><span class="p">]</span></div>


<div class="viewcode-block" id="JsonDecoder"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonDecoder">[docs]</a><span class="k">class</span> <span class="nc">JsonDecoder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    JSON value decoder.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JsonDecoder.decode_value"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonDecoder.decode_value">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decode_value</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decodes the JSON value from the string.</span>

<span class="sd">        :param content: String which contains encoded JSON value.</span>
<span class="sd">        :param pos: Position from zero in content where the encoded JSON value begins.</span>

<span class="sd">        :returns: Decoder result object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">()</span>

        <span class="n">first_char</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;Infinity&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_string</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">second_char</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">second_char</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;-Infinity&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_number</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_number</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="JsonDecoder.Result"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonDecoder.Result">[docs]</a>    <span class="k">class</span> <span class="nc">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decoder result value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">num_read_chars</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">success</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_read_chars</span> <span class="o">=</span> <span class="n">num_read_chars</span>

<div class="viewcode-block" id="JsonDecoder.Result.from_failure"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonDecoder.Result.from_failure">[docs]</a>        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">from_failure</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">],</span> <span class="n">num_read_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates decoder result value in case of failure.</span>

<span class="sd">            :param num_read_chars: Number of processed characters.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_read_chars</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">instance</span></div>

<div class="viewcode-block" id="JsonDecoder.Result.from_success"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonDecoder.Result.from_success">[docs]</a>        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">from_success</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
            <span class="n">num_read_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates decoder result value in case of success.</span>

<span class="sd">            :param value: Decoded value.</span>
<span class="sd">            :param num_read_chars: Number of read characters.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">num_read_chars</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">instance</span></div>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the decoder result.</span>

<span class="sd">            :returns: True in case of success, otherwise false.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the decoded JSON value.</span>

<span class="sd">            :returns: Decoded JSON value or None in case of failure.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">num_read_chars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the number of read characters from the string which contains encoded JSON value.</span>

<span class="sd">            In case of failure, it returns the number of processed (read) characters.</span>

<span class="sd">            :returns: Number of read characters.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_read_chars</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_decode_literal</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">decoded_object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">:</span>
        <span class="n">text_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">text_length</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>

        <span class="n">sub_content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">pos</span> <span class="p">:</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">text_length</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sub_content</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_success</span><span class="p">(</span><span class="n">decoded_object</span><span class="p">,</span> <span class="n">text_length</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">text_length</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_decode_string</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">:</span>
        <span class="n">decoded_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">end_of_string_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># we know that at the beginning is &#39;&quot;&#39;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">end_of_string_pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>

            <span class="n">next_char</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">end_of_string_pos</span><span class="p">]</span>
            <span class="n">end_of_string_pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">end_of_string_pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>

                <span class="n">next_next_char</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">end_of_string_pos</span><span class="p">]</span>
                <span class="n">end_of_string_pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">next_next_char</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">next_next_char</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\f</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                    <span class="n">decoded_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>  <span class="c1"># unicode escape</span>
                    <span class="n">unicode_escape_len</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="n">end_of_string_pos</span> <span class="o">+=</span> <span class="n">unicode_escape_len</span>
                    <span class="k">if</span> <span class="n">end_of_string_pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
                    <span class="n">sub_content</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">unicode_escape_len</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">end_of_string_pos</span><span class="p">]</span>
                    <span class="n">decoded_unicode</span> <span class="o">=</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_decode_unicode_escape</span><span class="p">(</span><span class="n">sub_content</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">decoded_unicode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">decoded_unicode</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># unknown escape character, not decoded...</span>
                    <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">decoded_string</span> <span class="o">+=</span> <span class="n">next_char</span>

        <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_success</span><span class="p">(</span><span class="n">decoded_string</span><span class="p">,</span> <span class="n">end_of_string_pos</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_decode_unicode_escape</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;unicode-escape&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_decode_number</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;JsonDecoder.Result&quot;</span><span class="p">:</span>
        <span class="n">number_content</span><span class="p">,</span> <span class="n">is_float</span> <span class="o">=</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">_extract_number</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">number_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">number_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_float</span><span class="p">:</span>
                <span class="n">float_number</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_content</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_success</span><span class="p">(</span><span class="n">float_number</span><span class="p">,</span> <span class="n">number_length</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">int_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_content</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_success</span><span class="p">(</span><span class="n">int_number</span><span class="p">,</span> <span class="n">number_length</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">(</span><span class="n">number_length</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_extract_number</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">end_of_number_pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="n">end_of_number_pos</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>  <span class="c1"># we already know that there is something after &#39;-&#39;</span>
            <span class="n">end_of_number_pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">accept_exp_sign</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_scientific_float</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">is_float</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">end_of_number_pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="n">next_char</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">end_of_number_pos</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">accept_exp_sign</span><span class="p">:</span>
                <span class="n">accept_exp_sign</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">next_char</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">):</span>
                    <span class="n">end_of_number_pos</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">next_char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">end_of_number_pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">next_char</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_scientific_float</span><span class="p">:</span>
                <span class="n">end_of_number_pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">is_float</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">is_scientific_float</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">accept_exp_sign</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_float</span><span class="p">:</span>
                <span class="n">end_of_number_pos</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">is_float</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="k">break</span>  <span class="c1"># pragma: no cover (to satisfy test coverage)</span>

        <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">end_of_number_pos</span><span class="p">],</span> <span class="n">is_float</span></div>


<div class="viewcode-block" id="JsonTokenizer"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer">[docs]</a><span class="k">class</span> <span class="nc">JsonTokenizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tokenizer used by JsonParser.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_io</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param text_io: Text stream to tokenize.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_io</span> <span class="o">=</span> <span class="n">text_io</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">JsonTokenizer</span><span class="o">.</span><span class="n">MAX_LINE_LEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_column_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_OF_FILE</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="k">else</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span> <span class="o">=</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">Result</span><span class="o">.</span><span class="n">from_failure</span><span class="p">()</span>

<div class="viewcode-block" id="JsonTokenizer.next"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonToken</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves to next token.</span>

<span class="sd">        :returns: Token.</span>
<span class="sd">        :raises JsonParserException: When unknown token is reached.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_next</span><span class="p">():</span>
            <span class="n">new_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">JsonTokenizer</span><span class="o">.</span><span class="n">MAX_LINE_LEN</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">new_content</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_token_column_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># stream is finished but last token is not EOF =&gt; value must be at the end</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_token_value</span><span class="p">()</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">+=</span> <span class="n">new_content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span></div>

<div class="viewcode-block" id="JsonTokenizer.get_token"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer.get_token">[docs]</a>    <span class="k">def</span> <span class="nf">get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonToken</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current token.</span>

<span class="sd">        :returns: Current token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span></div>

<div class="viewcode-block" id="JsonTokenizer.get_value"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets current value.</span>

<span class="sd">        :returns: Current value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span></div>

<div class="viewcode-block" id="JsonTokenizer.get_line"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer.get_line">[docs]</a>    <span class="k">def</span> <span class="nf">get_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets line number of the current token.</span>

<span class="sd">        :returns: Line number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span></div>

<div class="viewcode-block" id="JsonTokenizer.get_column"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonTokenizer.get_column">[docs]</a>    <span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets column number of the current token.</span>

<span class="sd">        :returns: Column number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_column_number</span></div>

    <span class="k">def</span> <span class="nf">_decode_next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_whitespaces</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_token_column_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span>

        <span class="n">next_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_OBJECT</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OBJECT</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">BEGIN_ARRAY</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;]&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_ARRAY</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">KEY_SEPARATOR</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">ITEM_SEPARATOR</span><span class="p">,</span> <span class="n">next_char</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span> <span class="o">=</span> <span class="n">JsonDecoder</span><span class="o">.</span><span class="n">decode_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span><span class="o">.</span><span class="n">num_read_chars</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># we are at the end of chunk =&gt; try to read more</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_token_value</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_skip_whitespaces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">next_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">next_char</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">END_OF_FILE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="n">next_next_char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">next_next_char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_set_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_token</span><span class="p">:</span> <span class="n">JsonToken</span><span class="p">,</span> <span class="n">new_value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">new_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">new_value</span>

    <span class="k">def</span> <span class="nf">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">new_column_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="n">new_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">=</span> <span class="n">new_column_number</span>

    <span class="k">def</span> <span class="nf">_set_token_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JsonParserException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JsonTokenizer:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_line_number</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_column_number</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="sa">f</span><span class="s2">&quot;Unknown token!&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_token</span><span class="p">(</span><span class="n">JsonToken</span><span class="o">.</span><span class="n">VALUE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">num_read_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoder_result</span><span class="o">.</span><span class="n">num_read_chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="n">num_read_chars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_number</span> <span class="o">+</span> <span class="n">num_read_chars</span><span class="p">)</span>

    <span class="n">MAX_LINE_LEN</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span></div>


<div class="viewcode-block" id="JsonReader"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonReader">[docs]</a><span class="k">class</span> <span class="nc">JsonReader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads zserio object tree defined by a type info from a text stream.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_io</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param text_io: Text stream to read.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_creator_adapter</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">JsonParser</span><span class="p">(</span><span class="n">text_io</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator_adapter</span><span class="p">)</span>

<div class="viewcode-block" id="JsonReader.read"><a class="viewcode-back" href="../../zserio.json.html#zserio.json.JsonReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">TypeInfo</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a zserio object tree defined by the given type info from the text steam.</span>

<span class="sd">        :param type_info: Type info defining the expected zserio object tree.</span>
<span class="sd">        :param arguments: Arguments of type defining the expected zserio object tree.</span>
<span class="sd">        :returns: Zserio object tree initialized using the JSON data.</span>
<span class="sd">        :raises PythonRuntimeException: When the JSON doesn&#39;t contain expected zserio object tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_creator_adapter</span><span class="o">.</span><span class="n">set_type</span><span class="p">(</span><span class="n">type_info</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">JsonParserException</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">PythonRuntimeException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> (JsonParser:&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">get_line</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">get_column</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator_adapter</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

    <span class="k">class</span> <span class="nc">_ObjectValueAdapter</span><span class="p">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="n">Observer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adapter for values which are encoded as Json objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the parsed value.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_BitBufferAdapter</span><span class="p">(</span><span class="n">_ObjectValueAdapter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The adapter which allows to parse Bit Buffer object from JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BitBuffer</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the created Bit Buffer object.</span>

<span class="sd">            :returns: Parsed Bit Buffer object.</span>
<span class="sd">            :raises PythonRuntimeException: In case of invalid use.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end in Bit Buffer!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">BitBuffer</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">begin_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected begin object in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">end_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end object in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">BEGIN_ARRAY_BUFFER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected begin array in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end array in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">visit_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;buffer&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">BEGIN_ARRAY_BUFFER</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;bitSize&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BITSIZE</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unknown key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in Bit Buffer!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unexpected key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">visit_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BITSIZE</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="nb">int</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bit_size</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unexpected value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in Bit Buffer!&quot;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">_State</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
            <span class="n">VISIT_KEY</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">BEGIN_ARRAY_BUFFER</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">VISIT_VALUE_BUFFER</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">VISIT_VALUE_BITSIZE</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_BytesAdapter</span><span class="p">(</span><span class="n">_ObjectValueAdapter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The adapter which allows to parse bytes object from JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bytearray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytearray</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the created bytes object.</span>

<span class="sd">            :returns: Parsed bytes object.</span>
<span class="sd">            :raises PythonRuntimeException: In case of invalid use.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end in bytes!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span>

        <span class="k">def</span> <span class="nf">begin_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected begin object in bytes!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">end_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end object in bytes!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">BEGIN_ARRAY_BUFFER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected begin array in bytes!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Unexpected end array in bytes!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">visit_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_KEY</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;buffer&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">BEGIN_ARRAY_BUFFER</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unknown key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in bytes!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unexpected key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in bytes!&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">visit_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="o">.</span><span class="n">_State</span><span class="o">.</span><span class="n">VISIT_VALUE_BUFFER</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JsonReader: Unexpected value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; in bytes!&quot;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">_State</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
            <span class="n">VISIT_KEY</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">BEGIN_ARRAY_BUFFER</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>
            <span class="n">VISIT_VALUE_BUFFER</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">_CreatorAdapter</span><span class="p">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="n">Observer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The adapter which allows to use ZserioTreeCreator as an JsonReader observer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">ZserioTreeCreator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_object</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">JsonReader</span><span class="o">.</span><span class="n">_ObjectValueAdapter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">TypeInfo</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Sets type which shall be created next. Resets the current object.</span>

<span class="sd">            :param type_info: Type info of the type which is to be created.</span>
<span class="sd">            :param arguments: Arguments of type defining the expected zserio object tree.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span> <span class="o">=</span> <span class="n">ZserioTreeCreator</span><span class="p">(</span><span class="n">type_info</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_object</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the created zserio object tree.</span>

<span class="sd">            :returns: Zserio object tree.</span>
<span class="sd">            :raises PythonRuntimeException: In case of invalid use.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Zserio tree not created!&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object</span>

        <span class="k">def</span> <span class="nf">begin_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">begin_object</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">begin_root</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">schema_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">get_field_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">schema_name</span>
                        <span class="k">if</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s2">&quot;extern&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s2">&quot;bytes&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">begin_compound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">schema_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">get_element_type</span><span class="p">()</span><span class="o">.</span><span class="n">schema_name</span>
                        <span class="k">if</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s2">&quot;extern&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BitBufferAdapter</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="n">schema_type</span> <span class="o">==</span> <span class="s2">&quot;bytes&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_BytesAdapter</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">begin_compound_element</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">end_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">end_root</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">end_compound</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># finish member</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">end_compound_element</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">begin_array</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: ZserioTreeCreator expects json object!&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">begin_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">end_array</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">end_array</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">end_array</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># finish array</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># finish member</span>

        <span class="k">def</span> <span class="nf">visit_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">visit_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">visit_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_object_value_adapter</span><span class="o">.</span><span class="n">visit_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: Adapter not initialized!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span><span class="s2">&quot;JsonReader: ZserioTreeCreator expects json object!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">expected_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">get_field_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">expected_type_info</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_key_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># finish member</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expected_type_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">get_element_type</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_creator</span><span class="o">.</span><span class="n">add_value_element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">expected_type_info</span><span class="p">))</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_convert_value</span><span class="p">(</span>
            <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">TypeAttribute</span><span class="o">.</span><span class="n">ENUM_ITEMS</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="o">.</span><span class="n">_enum_from_string</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">type_info</span><span class="o">.</span><span class="n">py_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">TypeAttribute</span><span class="o">.</span><span class="n">BITMASK_VALUES</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="o">.</span><span class="n">_bitmask_from_string</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">type_info</span><span class="o">.</span><span class="n">py_type</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_enum_from_string</span><span class="p">(</span>
            <span class="n">string_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">string_value</span><span class="p">:</span>
                <span class="n">first_char</span> <span class="o">=</span> <span class="n">string_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span> <span class="o">&lt;=</span> <span class="n">first_char</span> <span class="o">&lt;=</span> <span class="s2">&quot;Z&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">&lt;=</span> <span class="n">first_char</span> <span class="o">&lt;=</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                    <span class="n">py_item</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="o">.</span><span class="n">_parse_enum_string_value</span><span class="p">(</span><span class="n">string_value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">py_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">py_item</span>
                <span class="c1"># else it&#39;s a no match</span>

            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JsonReader: Cannot create enum &#39;</span><span class="si">{</span><span class="n">type_info</span><span class="o">.</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;from string value &#39;</span><span class="si">{</span><span class="n">string_value</span><span class="si">}</span><span class="s2">&#39;!&quot;</span>
            <span class="p">)</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_bitmask_from_string</span><span class="p">(</span>
            <span class="n">string_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">string_value</span><span class="p">:</span>
                <span class="n">first_char</span> <span class="o">=</span> <span class="n">string_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span> <span class="o">&lt;=</span> <span class="n">first_char</span> <span class="o">&lt;=</span> <span class="s2">&quot;Z&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span> <span class="o">&lt;=</span> <span class="n">first_char</span> <span class="o">&lt;=</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">first_char</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="o">.</span><span class="n">_parse_bitmask_string_value</span><span class="p">(</span><span class="n">string_value</span><span class="p">,</span> <span class="n">type_info</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">type_info</span><span class="o">.</span><span class="n">py_type</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;0&quot;</span> <span class="o">&lt;=</span> <span class="n">first_char</span> <span class="o">&lt;=</span> <span class="s2">&quot;9&quot;</span><span class="p">:</span>  <span class="c1"># bitmask can be only unsigned</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">JsonReader</span><span class="o">.</span><span class="n">_CreatorAdapter</span><span class="o">.</span><span class="n">_parse_bitmask_numeric_string_value</span><span class="p">(</span><span class="n">string_value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">type_info</span><span class="o">.</span><span class="n">py_type</span><span class="o">.</span><span class="n">from_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">raise</span> <span class="n">PythonRuntimeException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JsonReader: Cannot create bitmask &#39;</span><span class="si">{</span><span class="n">type_info</span><span class="o">.</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;from string value &#39;</span><span class="si">{</span><span class="n">string_value</span><span class="si">}</span><span class="s2">&#39;!&quot;</span>
            <span class="p">)</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_parse_enum_string_value</span><span class="p">(</span>
            <span class="n">string_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_info</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">TypeAttribute</span><span class="o">.</span><span class="n">ENUM_ITEMS</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">string_value</span> <span class="o">==</span> <span class="n">item_info</span><span class="o">.</span><span class="n">schema_name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_parse_bitmask_string_value</span><span class="p">(</span>
            <span class="n">string_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_info</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">TypeInfo</span><span class="p">,</span> <span class="n">RecursiveTypeInfo</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">identifiers</span> <span class="o">=</span> <span class="n">string_value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">identifier_with_spaces</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier_with_spaces</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">item_info</span> <span class="ow">in</span> <span class="n">type_info</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">TypeAttribute</span><span class="o">.</span><span class="n">BITMASK_VALUES</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="n">item_info</span><span class="o">.</span><span class="n">schema_name</span><span class="p">:</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">value</span> <span class="o">|=</span> <span class="n">item_info</span><span class="o">.</span><span class="n">py_item</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">_parse_bitmask_numeric_string_value</span><span class="p">(</span><span class="n">string_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">number_len</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">string_value</span><span class="p">[</span><span class="n">number_len</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s2">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">string_value</span><span class="p">[</span><span class="n">number_len</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s2">&quot;9&quot;</span><span class="p">:</span>
                <span class="n">number_len</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">string_value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">number_len</span><span class="p">])</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/Zserio.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../zserio.html">zserio package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../zserio.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.array.html">zserio.array module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitbuffer.html">zserio.bitbuffer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitfield.html">zserio.bitfield module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitposition.html">zserio.bitposition module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitreader.html">zserio.bitreader module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitsizeof.html">zserio.bitsizeof module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.bitwriter.html">zserio.bitwriter module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.builtin.html">zserio.builtin module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.cppbind.html">zserio.cppbind module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.creator.html">zserio.creator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.debugstring.html">zserio.debugstring module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.enum.html">zserio.enum module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.exception.html">zserio.exception module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.float.html">zserio.float module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.hashcode.html">zserio.hashcode module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.json.html">zserio.json module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.limits.html">zserio.limits module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.pubsub.html">zserio.pubsub module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.serialization.html">zserio.serialization module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.service.html">zserio.service module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.typeinfo.html">zserio.typeinfo module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zserio.walker.html">zserio.walker module</a></li>
</ul>
</li>
</ul>
</li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Copyright (c) 2018-2024, Navigation Data Standard e.v..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>